# UI と操作フロー

## 画面構成

- 上部: ファイル読込、プロジェクト保存/読込、床・空・AA・物理トグル、状態表示、FPS表示
- 左: 再生欄 + タイムライン欄
- 中央: 3D ビューポート
- 右: エフェクト欄
- 下部: 情報 / 補間 / ボーン / モーフ / カメラ / 照明 / アクセサリー / 出力

レイアウト本体は `index.html`、見た目は `src/index.css` で管理します。

## UI 制御クラス

`src/ui-controller.ts` が以下を担当します。

- ボタンクリックとショートカットのバインド
- `MmdManager` のコールバック受け取り
- タイムラインへの現在フレーム反映
- 複数モデルのセレクタ更新とアクティブ切替
- ステータス表示やトースト表示

## 下パネル補足

- `情報`:
  - モデルの統計表示（頂点/ボーン/モーフ）
  - `対象` セレクタでアクティブモデル切替
- `補間`:
  - 選択トラックの補間カーブ編集
- `ボーン`:
  - 選択ボーンの位置・回転調整
- `モーフ`:
  - 表示枠ごとのモーフスライダー調整
- `照明`:
  - 方位角 / 仰角
  - 光の強さ / 環境光
  - 影の濃さ / 境界幅
  - 影は UI 上は常時 ON 運用
- `カメラ`:
  - 視点（左面/正面/右面）
  - FOV（距離は内部制御用）
  - DoF関連は表示しない（操作はエフェクト欄へ集約）
- `アクセサリー`:
  - `対象` セレクタで `.x` アクセサリー選択
  - `表示/非表示`、`削除`
  - `親`（World またはモデル）、`ボーン`（モデル中心またはボーン名）
  - 位置（X/Y/Z）、回転（Rx/Ry/Rz）、拡大率（Si）
- `出力`:
  - アスペクト比、解像度プリセット、幅/高さ、画質
  - PNG 出力 / PNG連番出力

## エフェクト欄補足

- `情報 > 対象` でモデルを選択中:
  - 材質ごとのプリセット割り当て
- `情報 > 対象` で `Camera` 選択中:
  - ポストエフェクト（Contrast / Gamma / Distortion / Edge）
  - DoF関連コントロール

## タイムライン描画の仕組み

`src/timeline.ts` は 3 Canvas 構成です。

- static: トラック背景 + キーフレーム点
- overlay: ルーラー + 再生ヘッド
- label: 左ラベル列

パフォーマンス面では以下を採用しています。

- `requestAnimationFrame` で分離描画
- 可視フレーム範囲のみ描画
- 二分探索で該当キーフレームのみ走査
- カメラVMD読込時は `カメラ` レーンを別行で表示（モデル系トラックと同時表示）

## ショートカット

- `Space`: 再生/一時停止
- `Home`: 先頭へ
- `End`: 末尾へ
- `← / →`: 1フレーム移動
- `Shift + ← / →`: 10フレーム移動
- `Ctrl + O`: PMX/PMD 読み込み
- `Ctrl + M`: VMD 読み込み
- `Ctrl + Shift + M`: カメラVMD 読み込み
- `Ctrl + Shift + A`: 音源読み込み
- `Ctrl + Shift + S`: PNG出力
