# UI と操作フロー

## 画面構成

- 上部: PMX/VMD/カメラVMD/音源読込、PNG出力、床表示ON/OFF、状態表示、FPS表示
- 左: タイムライン
- 中央: 3D ビューポート
- 下部: 情報 / モーフ / カメラ / 照明 / 再生

レイアウト本体は `index.html`、見た目は `src/index.css` で管理します。

## UI 制御クラス

`src/ui-controller.ts` が以下を担当します。

- ボタンクリックとショートカットのバインド
- `MmdManager` のコールバック受け取り
- タイムラインへの現在フレーム反映
- 複数モデルのセレクタ更新とアクティブ切替
- ステータス表示やトースト表示

## 下パネル補足

- `情報`:
  - モデルの統計表示（頂点/ボーン/モーフ）
  - `対象` セレクタでアクティブモデル切替
- `照明`:
  - 方位角 / 仰角
  - 光の強さ / 環境光
  - 影の濃さ / 境界幅
  - 影は UI 上は常時 ON 運用
- `カメラ`:
  - XYZ移動フェーダー
  - XYZ回転フェーダー
  - FOVフェーダー

## タイムライン描画の仕組み

`src/timeline.ts` は 3 Canvas 構成です。

- static: トラック背景 + キーフレーム点
- overlay: ルーラー + 再生ヘッド
- label: 左ラベル列

パフォーマンス面では以下を採用しています。

- `requestAnimationFrame` で分離描画
- 可視フレーム範囲のみ描画
- 二分探索で該当キーフレームのみ走査
- カメラVMD読込時は `カメラ` レーンを別行で表示（モデル系トラックと同時表示）

## ショートカット

- `Space`: 再生/一時停止
- `Home`: 先頭へ
- `End`: 末尾へ
- `← / →`: 1フレーム移動
- `Shift + ← / →`: 10フレーム移動
- `Ctrl + O`: PMX/PMD 読み込み
- `Ctrl + M`: VMD 読み込み
- `Ctrl + Shift + M`: カメラVMD 読み込み
- `Ctrl + Shift + A`: 音源読み込み
- `Ctrl + Shift + S`: PNG出力
