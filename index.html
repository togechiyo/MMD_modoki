<!doctype html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MMD Motion Editor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
</head>

<body>
  <!-- App Shell -->
  <div id="app">
    <!-- Top Toolbar -->
    <header id="toolbar">
      <div class="toolbar-left">
        <div class="app-logo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="url(#grad1)" />
            <path d="M2 17L12 22L22 17" stroke="url(#grad2)" stroke-width="2" fill="none" />
            <path d="M2 12L12 17L22 12" stroke="url(#grad2)" stroke-width="2" fill="none" />
            <defs>
              <linearGradient id="grad1" x1="2" y1="2" x2="22" y2="12">
                <stop offset="0%" stop-color="#6366f1" />
                <stop offset="100%" stop-color="#ec4899" />
              </linearGradient>
              <linearGradient id="grad2" x1="2" y1="12" x2="22" y2="22">
                <stop offset="0%" stop-color="#6366f1" />
                <stop offset="100%" stop-color="#ec4899" />
              </linearGradient>
            </defs>
          </svg>
          <span class="app-title">MMD Motion Editor</span>
        </div>
        <div class="toolbar-divider"></div>
        <button id="btn-load-pmx" class="toolbar-btn" title="PMXモデルを読み込む">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z" />
          </svg>
          <span>PMX読込</span>
        </button>
        <button id="btn-load-vmd" class="toolbar-btn" title="VMDモーションを読み込む">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M6.804 8l.353-3.291A1.5 1.5 0 0 1 8.644 3.5h1.212a1.5 1.5 0 0 1 1.487 1.209L11.697 8H14.5a.5.5 0 0 1 0 1H1.5a.5.5 0 0 1 0-1H6.804z" />
            <path
              d="M2 12.5A1.5 1.5 0 0 1 3.5 11h9a1.5 1.5 0 0 1 1.5 1.5v.5a.5.5 0 0 1-1 0v-.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v.5a.5.5 0 0 1-1 0v-.5z" />
          </svg>
          <span>VMD読込</span>
        </button>
        <button id="btn-load-camera-vmd" class="toolbar-btn" title="カメラVMDを読み込む">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M2.5 5A1.5 1.5 0 0 1 4 3.5h5A1.5 1.5 0 0 1 10.5 5v1h1.2L14 4.5V11.5L11.7 10H10.5v1A1.5 1.5 0 0 1 9 12.5H4A1.5 1.5 0 0 1 2.5 11V5zm4 5A2.5 2.5 0 1 0 6.5 5a2.5 2.5 0 0 0 0 5z" />
          </svg>
          <span>カメラVMD</span>
        </button>
        <button id="btn-load-mp3" class="toolbar-btn" title="音源ファイルを読み込む">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path
              d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13s1.12-2 2.5-2S6 11.895 6 13zm9-2c0 1.105-1.12 2-2.5 2S10 12.105 10 11s1.12-2 2.5-2S15 9.895 15 11z" />
            <path fill-rule="evenodd" d="M15 3v8h-1V3H6v10H5V3a1 1 0 011-1h8a1 1 0 011 1z" />
          </svg>
          <span>音源読込</span>
        </button>
        <button id="btn-export-png" class="toolbar-btn" title="現在の描画をPNGで保存">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M4 2h8a1 1 0 0 1 1 1v2h-2V4H5v7h2v2H4a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1z" />
            <path d="M8 8h2V5l3 3-3 3V8H8z" />
          </svg>
          <span>PNG出力</span>
        </button>
        <button id="btn-toggle-ground" class="toolbar-btn toggle-on" title="地面表示を切り替える" aria-pressed="true">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M1 4h14v8H1z" />
            <path d="M1 8h14M8 4v8" stroke="currentColor" stroke-width="1" fill="none" />
          </svg>
          <span id="ground-toggle-text">床表示ON</span>
        </button>
        <button id="btn-toggle-physics" class="toolbar-btn toggle-on" title="物理演算の有効/無効を切り替える" aria-pressed="true">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
            <path d="M8 1.5a3 3 0 0 1 3 3v1h1.5a2 2 0 0 1 0 4H11v1a3 3 0 0 1-6 0v-1H3.5a2 2 0 0 1 0-4H5v-1a3 3 0 0 1 3-3z" />
          </svg>
          <span id="physics-toggle-text">物理ON</span>
        </button>
      </div>
      <div class="toolbar-right">
        <div id="perf-display" class="perf-badge">
          <span id="fps-value">--</span>
          <span class="perf-label">FPS</span>
          <span class="perf-sep">|</span>
          <span id="engine-type-badge" class="engine-badge">WebGL2</span>
        </div>
        <div id="status-indicator" class="status-badge">
          <span class="status-dot"></span>
          <span id="status-text">待機中</span>
        </div>
      </div>
    </header>

    <!-- Main Content Area -->
    <div id="main-content">
      <!-- Left Panel: Timeline -->
      <aside id="timeline-panel">
        <div class="panel-header">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
            <path d="M1 1h12v2H1V1zm0 4h12v2H1V5zm0 4h12v2H1V9z" />
          </svg>
          <span>タイムライン</span>
        </div>
        <div id="timeline-container">
          <!-- Fixed left: frame labels -->
          <div id="timeline-labels">
            <canvas id="timeline-label-canvas"></canvas>
          </div>
          <!-- Scrollable right: track area with ruler overlay -->
          <div id="timeline-tracks-wrapper">
            <canvas id="timeline-overlay-canvas"></canvas>
            <div id="timeline-tracks-scroll">
              <canvas id="timeline-canvas"></canvas>
            </div>
          </div>
        </div>
      </aside>

      <!-- Center: 3D Viewport -->
      <main id="viewport-container">
        <canvas id="render-canvas"></canvas>
        <div id="viewport-overlay" class="viewport-overlay">
          <div class="viewport-empty-state">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none" opacity="0.3">
              <path d="M32 4L4 20V44L32 60L60 44V20L32 4Z" stroke="currentColor" stroke-width="2" />
              <path d="M32 60V36" stroke="currentColor" stroke-width="2" />
              <path d="M4 20L32 36L60 20" stroke="currentColor" stroke-width="2" />
            </svg>
            <p>PMXモデルを読み込んでください</p>
            <span class="hint-text">ツールバーの「PMX読込」ボタンか、Ctrl+Oで開く</span>
          </div>
        </div>
      </main>
    </div>

    <!-- Bottom Panel: Morph + Camera + Controls -->
    <footer id="bottom-panel">
      <div class="bottom-panel-inner">

        <!-- 1: Model Info -->
        <section id="info-section" class="bottom-section">
          <div class="section-header">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <circle cx="7" cy="7" r="6" fill="none" stroke="currentColor" stroke-width="1.5" />
              <path d="M7 4v1M7 6.5v4" />
            </svg>
            <span>情報</span>
          </div>
          <div id="model-info" class="model-info">
            <div class="info-row">
              <span class="info-label">対象</span>
              <select id="info-model-select" class="info-model-select" disabled>
                <option value="">-</option>
              </select>
            </div>
            <div class="info-row"><span class="info-label">モデル</span><span id="info-model-name"
                class="info-value">-</span></div>
            <div class="info-row"><span class="info-label">頂点</span><span id="info-vertices" class="info-value">-</span>
            </div>
            <div class="info-row"><span class="info-label">ボーン</span><span id="info-bones" class="info-value">-</span>
            </div>
            <div class="info-row"><span class="info-label">モーフ</span><span id="info-morphs" class="info-value">-</span>
            </div>
          </div>
        </section>

        <!-- 2: Morph Controls -->
        <section id="morph-section" class="bottom-section">
          <div class="section-header">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <circle cx="7" cy="5" r="3" />
              <path d="M2 12c0-2.5 2.2-4 5-4s5 1.5 5 4" />
            </svg>
            <span>モーフ</span>
          </div>
          <div id="morph-controls" class="morph-controls">
            <div class="morph-empty-state">モデル未読込</div>
          </div>
        </section>

        <!-- 3: Camera Controls -->
        <section id="camera-section" class="bottom-section">
          <div class="section-header">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <path d="M2 3h7v8H2V3zm8 1l3-2v10l-3-2V4z" />
            </svg>
            <span>カメラ</span>
          </div>
          <div id="camera-controls" class="camera-controls">
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">X移動</label>
              <input type="range" id="cam-pos-x" class="cam-slider" min="-100" max="100" value="0" step="0.1">
              <span id="cam-pos-x-val" class="value-display">0.0</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">Y移動</label>
              <input type="range" id="cam-pos-y" class="cam-slider" min="-50" max="150" value="10" step="0.1">
              <span id="cam-pos-y-val" class="value-display">10.0</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">Z移動</label>
              <input type="range" id="cam-pos-z" class="cam-slider" min="-200" max="200" value="-30" step="0.1">
              <span id="cam-pos-z-val" class="value-display">-30.0</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">X回転</label>
              <input type="range" id="cam-rot-x" class="cam-slider" min="-180" max="180" value="0" step="1">
              <span id="cam-rot-x-val" class="value-display">0°</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">Y回転</label>
              <input type="range" id="cam-rot-y" class="cam-slider" min="-180" max="180" value="0" step="1">
              <span id="cam-rot-y-val" class="value-display">0°</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">Z回転</label>
              <input type="range" id="cam-rot-z" class="cam-slider" min="-180" max="180" value="0" step="1">
              <span id="cam-rot-z-val" class="value-display">0°</span>
            </div>
            <div class="control-row cam-slider-row">
              <label class="cam-axis-label">FOV</label>
              <input type="range" id="cam-fov" class="cam-slider" min="10" max="120" value="30">
              <span id="cam-fov-value" class="value-display">30°</span>
            </div>
          </div>
        </section>

        <!-- 4: Lighting Controls -->
        <section id="lighting-section" class="bottom-section">
          <div class="section-header">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <circle cx="7" cy="7" r="2.5" />
              <path
                d="M7 1v2M7 11v2M1 7h2M11 7h2M3.22 3.22l1.41 1.41M9.37 9.37l1.41 1.41M3.22 10.78l1.41-1.41M9.37 4.63l1.41-1.41"
                stroke="currentColor" stroke-width="1.2" fill="none" />
            </svg>
            <span>照明</span>
          </div>
          <div class="lighting-controls">
            <div class="light-row">
              <span class="light-label">方位角</span>
              <input type="range" id="light-azimuth" class="light-slider" min="-180" max="180" value="20" step="1">
              <span id="light-azimuth-val" class="light-value">20°</span>
            </div>
            <div class="light-row">
              <span class="light-label">仰角</span>
              <input type="range" id="light-elevation" class="light-slider" min="-85" max="-5" value="-50" step="1">
              <span id="light-elevation-val" class="light-value">-50°</span>
            </div>
            <div class="light-row">
              <span class="light-label">光の強さ</span>
              <input type="range" id="light-intensity" class="light-slider" min="0" max="200" value="80" step="1">
              <span id="light-intensity-val" class="light-value">0.8</span>
            </div>
            <div class="light-row">
              <span class="light-label">環境光</span>
              <input type="range" id="light-ambient" class="light-slider" min="0" max="200" value="20" step="1">
              <span id="light-ambient-val" class="light-value">0.2</span>
            </div>
            <div class="light-row">
              <span class="light-label">影の濃さ</span>
              <input type="range" id="light-shadow" class="light-slider" min="0" max="100" value="45" step="1">
              <span id="light-shadow-val" class="light-value">0.45</span>
            </div>
            <div class="light-row">
              <span class="light-label">境界幅</span>
              <input type="range" id="light-shadow-softness" class="light-slider" min="5" max="120" value="35" step="1">
              <span id="light-shadow-softness-val" class="light-value">0.035</span>
            </div>
          </div>
        </section>

        <!-- 5: Playback Controls -->
        <section id="playback-section" class="bottom-section">
          <div class="section-header">
            <svg width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
              <path d="M4 2l8 5-8 5V2z" />
            </svg>
            <span>再生</span>
          </div>
          <div id="playback-controls" class="playback-controls">
            <div class="transport-buttons">
              <button id="btn-skip-start" class="transport-btn" title="先頭へ">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M4 2h2v12H4V2zm2 6l7 5V3L6 8z" />
                </svg>
              </button>
              <button id="btn-play" class="transport-btn play-btn" title="再生">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M5 3l12 7-12 7V3z" />
                </svg>
              </button>
              <button id="btn-pause" class="transport-btn" title="一時停止" style="display:none;">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                  <rect x="4" y="3" width="4" height="14" />
                  <rect x="12" y="3" width="4" height="14" />
                </svg>
              </button>
              <button id="btn-stop" class="transport-btn" title="停止">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <rect x="3" y="3" width="10" height="10" />
                </svg>
              </button>
              <button id="btn-skip-end" class="transport-btn" title="末尾へ">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                  <path d="M10 2h2v12h-2V2zm-2 6L1 13V3l7 5z" />
                </svg>
              </button>
            </div>
            <div class="frame-display">
              <span class="frame-label">Frame</span>
              <span id="current-frame" class="frame-number">0</span>
              <span class="frame-separator">/</span>
              <span id="total-frames" class="frame-number">0</span>
            </div>
            <div class="speed-control">
              <label>Speed</label>
              <select id="playback-speed">
                <option value="0.25">0.25x</option>
                <option value="0.5">0.5x</option>
                <option value="1" selected>1x</option>
                <option value="1.5">1.5x</option>
                <option value="2">2x</option>
              </select>
            </div>
            <!-- Volume Fader -->
            <div class="volume-control">
              <button id="btn-mute" class="volume-mute-btn" title="ミュート切替">
                <svg id="icon-volume-on" width="14" height="14" viewBox="0 0 14 14" fill="currentColor">
                  <path d="M2 5h3l4-3v10l-4-3H2V5zm8 .5a3 3 0 0 1 0 3" stroke="currentColor" stroke-width="1.2"
                    fill="none" />
                  <path d="M11.5 3.5a5 5 0 0 1 0 7" stroke="currentColor" stroke-width="1.2" fill="none" />
                </svg>
                <svg id="icon-volume-off" width="14" height="14" viewBox="0 0 14 14" fill="currentColor"
                  style="display:none">
                  <path d="M2 5h3l4-3v10l-4-3H2V5z" />
                  <path d="M10 5l3 4m0-4l-3 4" stroke="currentColor" stroke-width="1.2" fill="none" />
                </svg>
              </button>
              <input type="range" id="volume-slider" class="volume-slider" min="0" max="100" value="100" step="1">
              <span id="volume-value" class="volume-value">100%</span>
            </div>
          </div>
        </section>

        <!-- 6〜8: 空き（将来の拡張用） -->
        <section id="panel-slot-6" class="bottom-section bottom-section--empty"></section>
        <section id="panel-slot-7" class="bottom-section bottom-section--empty"></section>
        <section id="panel-slot-8" class="bottom-section bottom-section--empty"></section>

      </div>
    </footer>

    <script type="module" src="/src/renderer.ts"></script>
</body>

</html>
